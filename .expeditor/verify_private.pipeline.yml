---
expeditor:
  defaults:
    buildkite:
      timeout_in_minutes: 120
      retry:
        automatic:
          limit: 1

steps:

  - label: lint-ruby-3.4.2
    command:
      - RAKE_TASK=test:lint /workdir/.expeditor/buildkite/verify.sh
    expeditor:
      secrets: true
      executor:
        docker:
          image: ruby:3.4.2-bullseye

  - label: run-tests-ruby-3.4.2
    command:
      - /workdir/.expeditor/buildkite/verify.sh
    expeditor:
      secrets: true
      executor:
        docker:
          image: ruby:3.4.2-bullseye

  - label: isolated-tests-ruby-3.4.2
    command:
      - RAKE_TASK=test:isolated /workdir/.expeditor/buildkite/verify.sh
    expeditor:
      secrets: true
      executor:
        docker:
          image: ruby:3.4.2-bullseye

  # - label: run-tests-ruby-3.4.2-windows
  #   command:
  #     - /workdir/.expeditor/buildkite/verify.ps1
  #   expeditor:
  #     secrets: true
  #     executor:
  #       docker:
  #         environment:
  #           - BUILDKITE
  #         host_os: windows
  #         shell: ["powershell", "-Command"]
  #         image: rubydistros/windows-2019:3.4.2
