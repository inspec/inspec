<!DOCTYPE html><html><head><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" /><link href="/favicon.png" rel="icon" type="image/png" /><link href="/favicon.ico" rel="icon" /><title>Chef InSpec DSL</title><meta name="description" /><link href="/css/inspec_tutorial.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/vendor/fontawesome.min.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/site.css" rel="stylesheet" /></head><body class="docs docs_reference docs_reference_dsl_inspec docs_reference_dsl_inspec_index"><script>gm_session_id = 'inspecGlobalMessage8';</script><div class="container"><nav class="shadow" id="main-nav"><progress value="0"></progress><div id="main-nav-ctas"><a class="main-nav--logo" href="/"><img alt="logo for Chef InSpec" onerror="this.src='/images/chef-inspec.png'" src="/images/chef-inspec.svg" /></a><i class="fa fa-bars main-nav--toggle strict-right mobile-show"></i><ul class="main-nav--links"><li class="main-nav--link"><a href="/tutorials" class="link " <span class="main-nav--link-text">Tutorials</span></a></li><li class="main-nav--link"><a href="/docs" class="link " <span class="main-nav--link-text">Docs</span></a></li><li class="main-nav--link"><a href="/community" class="link " <span class="main-nav--link-text">Community</span></a></li><li class="main-nav--link"><a class="link" href="https://github.com/chef/inspec"><i class="fa fa-github"></i><span class="main-nav--link-text">Github</span></a></li><li class="nav-cta"><a class="button btn-sm btn-purple" href="/downloads"><i class="fa fa-cloud-download"></i>Download</a></li></ul></div></nav><main id="main-content"><!--header search--><header class="bg-gradient margin-top-offset relative"><div class="row"><div class="columns large-12 medium-12 z-20"><div class="flex align margin-both"><form action="/docs/search/" class="main-sidebar--search shadow-dark" method="get"><input class="st-default-search-input" name="q" placeholder="Search documentation..." type="text" /><button action="/docs/search/" class="search shadow-dark margin-left-xs" method="get"></button><i class="fa fa-search t-white"></i></form></div></div></div><div id="particles-second"><canvas class="particles-js-canvas-el" /></div></header><div class="row margin-both relative"><column class="columns large-3 medium-3 mobile-hide" id="sidebar"><ul class="main-sidebar--links"><li class="main-sidebar--link"><small>Getting Started</small><ul class="main-sidebar--list no-bullet"><li class="main-sidebar--list--item--a"><a href="/docs">Overview</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/downloads">Get Chef InSpec</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/platforms">Chef InSpec for the cloud</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/tutorials">Tutorials</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/inspec_and_friends">Chef InSpec and friends</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/glossary">Chef InSpec Glossary</a><i class="fa fa-angle-double-right focus strict-right"></i></li></ul></li><li class="main-sidebar--link"><small>Reference</small><ul class="main-sidebar--list no-bullet"><li class="main-sidebar--list--item--a"><a href="/docs/reference/cli">inspec executable</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/profiles">Profiles</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/resources">Resources</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/inputs">Inputs</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/matchers">Matchers</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/reporters">Reporters</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/config">Configuration</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a t-purple"><a href="/docs/reference/dsl_inspec">Chef InSpec DSL</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/style">Profile Style guide</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/dsl_resource">Custom Resources</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/plugins">Plugins</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/plugin_kitchen_inspec">kitchen-inspec</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/shell">inspec shell</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/habitat">Chef Habitat Integration</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/migration">Migration from Serverspec</a><i class="fa fa-angle-double-right focus strict-right"></i></li><li class="main-sidebar--list--item--a"><a href="/docs/reference/waivers">Waivers (beta)</a><i class="fa fa-angle-double-right focus strict-right"></i></li></ul></li></ul></column><column class="columns large-9 medium-9 mobile-12" id="mainbar"><h1 id="chef-inspec-dsl">Chef InSpec DSL</h1>

<p>Chef InSpec is a run-time framework and rule language used to specify compliance, security, and policy requirements. It includes a collection of resources that help you write auditing controls quickly and easily. The syntax used by both open source and |chef compliance| auditing is the same. The open source |Chef InSpec resource| framework is compatible with |chef compliance|.</p>

<p>The Chef InSpec DSL is a Ruby DSL for writing audit controls, which includes audit resources that you can invoke.</p>

<p>The following sections describe the syntax and show some simple examples of using the Chef InSpec resources.</p>

<h2 id="syntax">Syntax</h2>

<p>The following resource tests |ssh| server configuration. For example, a simple control may described as:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">describe</span> <span class="n">sshd_config</span> <span class="k">do</span>
  <span class="n">its</span><span class="p">(</span><span class="s1">'Port'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">cmp</span> <span class="mi">22</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<p>In various use cases like implementing IT compliance across different departments, it becomes handy to extend the control with metadata. Each control may define an additional <code>impact</code>, <code>title</code> or <code>desc</code>. An example looks like:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'sshd-8'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">0.6</span>
  <span class="n">title</span> <span class="s1">'Server: Configure the service port'</span>
  <span class="n">desc</span> <span class="s1">'Always specify which port the SSH server should listen.'</span>
  <span class="n">desc</span> <span class="s1">'rationale'</span><span class="p">,</span> <span class="s1">'This ensures that there are no unexpected settings'</span> <span class="c1"># Requires Chef InSpec &gt;=2.3.4</span>
  <span class="n">tag</span> <span class="s1">'ssh'</span><span class="p">,</span><span class="s1">'sshd'</span><span class="p">,</span><span class="s1">'openssh-server'</span>
  <span class="n">tag</span> <span class="ss">cce: </span><span class="s1">'CCE-27072-8'</span>
  <span class="n">ref</span> <span class="s1">'NSA-RH6-STIG - Section 3.5.2.1'</span><span class="p">,</span> <span class="ss">url: </span><span class="s1">'https://www.nsa.gov/ia/_files/os/redhat/rhel5-guide-i731.pdf'</span>

  <span class="n">describe</span> <span class="n">sshd_config</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'Port'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">cmp</span> <span class="mi">22</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>where</p>

<ul>
<li><code>&#39;sshd-8&#39;</code> is the name of the control</li>
<li><code>impact</code>, <code>title</code>, and <code>desc</code> define metadata that fully describes the importance of the control, its purpose, with a succinct and complete description</li>
<li><code>desc</code> when given only one argument it sets the default description. As of Chef InSpec 2.3.4, when given 2 arguments (see: <code>&#39;rationale&#39;</code>) it will use the first argument as a header when rendering in Automate</li>
<li><code>impact</code> is a string, or numeric that measures the importance of the compliance results.
Valid strings for impact are <code>none</code>, <code>low</code>, <code>medium</code>, <code>high</code>, and <code>critical</code>. The values are based off CVSS 3.0.
A numeric value must be between <code>0.0</code> and <code>1.0</code>. The value ranges are:

<ul>
<li><code>0.0 to &lt;0.01</code> these are controls with no impact, they only provide information</li>
<li><code>0.01 to &lt;0.4</code> these are controls with low impact</li>
<li><code>0.4 to &lt;0.7</code> these are controls with medium impact</li>
<li><code>0.7 to &lt;0.9</code> these are controls with high impact</li>
<li><code>0.9 to 1.0</code> these are critical controls</li>
</ul></li>
<li><code>tag</code> is optional meta-information with with key or key-value pairs</li>
<li><code>ref</code> is a reference to an external document</li>
<li><code>describe</code> is a block that contains at least one test. A <code>control</code> block must contain at least one <code>describe</code> block, but may contain as many as required</li>
<li><code>sshd_config</code> is a Chef InSpec resource. For the full list of Chef InSpec resources, see Chef InSpec resource documentation</li>
<li><code>its(&#39;Port&#39;)</code> is the matcher; <code>{ should eq &#39;22&#39; }</code> is the test. A <code>describe</code> block must contain at least one matcher, but may contain as many as required</li>
</ul>

<h2 id="advanced-concepts">Advanced concepts</h2>

<p>With Chef InSpec it is possible to check if at least one of a collection of checks is true. For example: If a setting is configured in two different locations, you may want to test if either configuration A or configuration B have been set. This is accomplished via <code>describe.one</code>. It defines a block of tests with at least one valid check.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">describe</span><span class="p">.</span><span class="nf">one</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="no">ConfigurationA</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'setting_1'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="kp">true</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="no">ConfigurationB</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'setting_2'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="kp">true</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3 id="sensitive-resources">Sensitive resources</h3>

<p>In some scenarios, you may be writing checks involving resources with sensitive content (e.g. a file resource). In the case of failures, it may be desired to suppress output. This can be done by adding the <code>:sensitive</code> flag to the resource definition</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">describe</span> <span class="n">file</span><span class="p">(</span><span class="s1">'/tmp/mysecretfile'</span><span class="p">),</span> <span class="ss">:sensitive</span> <span class="k">do</span>
  <span class="n">its</span><span class="p">(</span><span class="s1">'content'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">match</span> <span class="sr">/secret_info/</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="examples">Examples</h2>

<p>The following examples show simple compliance tests using a single <code>control</code> block.</p>

<h2 id="test-system-event-log">Test System Event Log</h2>

<p>The following test shows how to audit machines running Windows 2012 R2 that password complexity is enabled:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'windows-account-102'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="s1">'critical'</span>
  <span class="n">title</span> <span class="s1">'Windows Password Complexity is Enabled'</span>
  <span class="n">desc</span> <span class="s1">'Password must meet complexity requirement'</span>
  <span class="n">describe</span> <span class="n">security_policy</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'PasswordComplexity'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">cmp</span> <span class="mi">1</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="test-if-postgresql-passwords-are-empty">Test if PostgreSQL passwords are empty</h2>

<p>The following test shows how to audit machines running PostgreSQL to ensure that passwords are not empty.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'postgres-7'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">1.0</span>
  <span class="n">title</span> <span class="s2">"Don't allow empty passwords"</span>
  <span class="n">describe</span> <span class="n">postgres_session</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="s1">'pass'</span><span class="p">).</span><span class="nf">query</span><span class="p">(</span><span class="s2">"SELECT * FROM pg_shadow WHERE passwd IS NULL;"</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'output'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">cmp</span> <span class="s1">''</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="test-if-mysql-passwords-are-in-env">Test if MySQL passwords are in ENV</h2>

<p>The following test shows how to audit machines running MySQL to ensure that passwords are not stored in <code>ENV</code>:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'mysql-3'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">1.0</span>
  <span class="n">title</span> <span class="s1">'Do not store your MySQL password in your ENV'</span>
  <span class="n">desc</span> <span class="s1">'
    Storing credentials in your ENV may easily expose
    them to an attacker. Prevent this at all costs.
  '</span>
  <span class="n">describe</span> <span class="n">command</span><span class="p">(</span><span class="s1">'env'</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'stdout'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">match</span> <span class="sr">/^MYSQL_PWD=/</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="test-if-etc-ssh-is-a-directory">Test if <code>/etc/ssh</code> is a Directory</h2>

<p>The following test shows how to audit machines to ensure that <code>/etc/ssh</code> is a directory:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'basic-1'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">1.0</span>
  <span class="n">title</span> <span class="s1">'/etc/ssh should be a directory'</span>
  <span class="n">desc</span> <span class="s1">'
    In order for OpenSSH to function correctly, its
    configuration path must be a folder.
  '</span>
  <span class="n">describe</span> <span class="n">file</span><span class="p">(</span><span class="s1">'/etc/ssh'</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_directory</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="test-if-apache-running">Test if Apache running</h2>

<p>The following test shows how to audit machines to ensure that Apache is enabled and running:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'apache-1'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="s1">'medium'</span>
  <span class="n">title</span> <span class="s1">'Apache2 should be configured and running'</span>
  <span class="n">describe</span> <span class="n">service</span><span class="p">(</span><span class="n">apache</span><span class="p">.</span><span class="nf">service</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_enabled</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_running</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="test-if-insecure-packages-are-installed">Test if insecure packages are installed</h2>

<p>The following test shows how to audit machines for insecure packages:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'cis-os-services-5.1.3'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">0.7</span>
  <span class="n">title</span> <span class="s1">'5.1.3 Ensure rsh client is not installed'</span>
  <span class="n">describe</span> <span class="n">package</span><span class="p">(</span><span class="s1">'rsh'</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_installed</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="n">describe</span> <span class="n">package</span><span class="p">(</span><span class="s1">'rsh-redone-client'</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_installed</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="test-windows-registry-keys">Test Windows Registry Keys</h2>

<p>The following test shows how to audit machines to ensure Safe DLL Search Mode is enabled:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'windows-base-101'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">1.0</span>
  <span class="n">title</span> <span class="s1">'Safe DLL Search Mode is Enabled'</span>
  <span class="n">desc</span> <span class="s1">'
    @link: https://msdn.microsoft.com/en-us/library/ms682586(v=vs.85).aspx
  '</span>
  <span class="n">describe</span> <span class="n">registry_key</span><span class="p">(</span><span class="s1">'HKLM\\System\\CurrentControlSet\\Control\\Session Manager'</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">exist</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_property_value</span><span class="p">(</span><span class="s1">'SafeDllSearchMode'</span><span class="p">,</span> <span class="ss">:type_dword</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="exclude-specific-test">Exclude specific test</h2>

<p>This shows how to allow skipping certain tests if conditions are not met, by using <code>only_if</code>.
In this example the test will not be performed if <code>redis-cli</code> command does not exist. A optional
message can say why it was skipped.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'nutcracker-connect-redis-001'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="s1">'critical'</span>
  <span class="n">title</span> <span class="s1">'Check if nutcracker can pass commands to redis'</span>
  <span class="n">desc</span> <span class="s1">'execute redis-cli set key command, to check connectivity of the service'</span>

  <span class="n">only_if</span><span class="p">(</span><span class="s1">'redis is not installed.'</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">command</span><span class="p">(</span><span class="s1">'redis-cli'</span><span class="p">).</span><span class="nf">exist?</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="n">command</span><span class="p">(</span><span class="s1">'redis-cli SET test_inspec "HELLO"'</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'stdout'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">match</span> <span class="sr">/OK/</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Mixing this with other conditionals (like checking existence of the files etc.) can help to test different test paths using InSpec. This way you can skip certain tests which would 100% fail due to the way servers are prepared, but you know that the same test suites are reused later in different circumstances by different teams.</p>

<h2 id="additional-metadata-for-controls">Additional metadata for controls</h2>

<p>The following example illustrates various ways to add tags and references to <code>control</code></p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'ssh-1'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">1.0</span>

  <span class="n">title</span> <span class="s1">'Allow only SSH Protocol 2'</span>
  <span class="n">desc</span> <span class="s1">'
    Only SSH protocol version 2 connections should be permitted.
    The default setting in /etc/ssh/sshd_config is correct, and can be
    verified by ensuring that the following line appears: Protocol 2
  '</span>

  <span class="n">tag</span> <span class="s1">'production'</span><span class="p">,</span><span class="s1">'development'</span>
  <span class="n">tag</span> <span class="s1">'ssh'</span><span class="p">,</span><span class="s1">'sshd'</span><span class="p">,</span><span class="s1">'openssh-server'</span>

  <span class="n">tag</span> <span class="ss">cce: </span><span class="s1">'CCE-27072-8'</span>
  <span class="n">tag</span> <span class="ss">disa: </span><span class="s1">'RHEL-06-000227'</span>

  <span class="n">tag</span> <span class="ss">remediation: </span><span class="s1">'stig_rhel6/recipes/sshd-config.rb'</span>
  <span class="n">tag</span> <span class="ss">remediation: </span><span class="s1">'https://supermarket.chef.io/cookbooks/ssh-hardening'</span>

  <span class="n">ref</span> <span class="s1">'NSA-RH6-STIG - Section 3.5.2.1'</span><span class="p">,</span> <span class="ss">url: </span><span class="s1">'https://www.nsa.gov/ia/_files/os/redhat/rhel5-guide-i731.pdf'</span>
  <span class="n">ref</span> <span class="s1">'http://people.redhat.com/swells/scap-security-guide/RHEL/6/output/ssg-centos6-guide-C2S.html'</span>

  <span class="n">describe</span> <span class="n">ssh_config</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'Protocol'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">cmp</span> <span class="mi">2</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h1 id="using-ruby-in-inspec">Using Ruby in InSpec</h1>

<p>The Chef InSpec DSL is a Ruby based language. This allows you to be flexible with
Ruby code in controls:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">json_obj</span> <span class="o">=</span> <span class="n">json</span><span class="p">(</span><span class="s1">'/file.json'</span><span class="p">)</span>
<span class="n">json_obj</span><span class="p">[</span><span class="s1">'keys'</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
  <span class="o">..</span>
<span class="k">end</span>
</code></pre></div>
<p>Ruby allows a lot of freedoms, but should be limited in controls so that they
remain portable and easy to understand. Please see our <a href="https://www.inspec.io/docs/reference/style/">profile style guide</a>.</p>

<p>Core and custom resources are written as regular Ruby classes which inherit from
<code>Inspec.resource</code>.</p>

<h2 id="interactive-debugging-with-pry">Interactive Debugging with Pry</h2>

<p>Here&rsquo;s a sample Chef InSpec control that uses Ruby variables to instantiate
a Chef InSpec resource once and use the content in multiple tests.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">control</span> <span class="s1">'check-perl'</span> <span class="k">do</span>
  <span class="n">impact</span> <span class="mf">0.3</span>
  <span class="n">title</span> <span class="s1">'Check perl compiled options and permissions'</span>
  <span class="n">perl_out</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="s1">'perl -V'</span><span class="p">)</span>
  <span class="c1">#require 'pry'; binding.pry;</span>
  <span class="n">describe</span> <span class="n">perl_out</span> <span class="k">do</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'exit_status'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'stdout'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">match</span> <span class="sr">/USE_64_BIT_ALL/</span> <span class="p">}</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'stdout'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">match</span> <span class="sr">/useposix=true/</span> <span class="p">}</span>
    <span class="n">its</span><span class="p">(</span><span class="s1">'stdout'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">match</span> <span class="sr">/-fstack-protector/</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="c1"># extract an array of include directories</span>
  <span class="n">perl_inc</span> <span class="o">=</span> <span class="n">perl_out</span><span class="p">.</span><span class="nf">stdout</span><span class="p">.</span><span class="nf">partition</span><span class="p">(</span><span class="s1">'@INC:'</span><span class="p">).</span><span class="nf">last</span><span class="p">.</span><span class="nf">strip</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
  <span class="c1"># ensure include directories are only writable by 'owner'</span>
  <span class="n">perl_inc</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
    <span class="n">describe</span> <span class="n">directory</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="nf">strip</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_writable</span><span class="p">.</span><span class="nf">by</span> <span class="s1">'group'</span> <span class="p">}</span>
      <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_writable</span><span class="p">.</span><span class="nf">by</span> <span class="s1">'other'</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>An <strong>advanced</strong> but very useful Ruby tip. In the previous example, I
commented out the <code>require &#39;pry&#39;; binding.pry;</code> line. If you remove the
<code>#</code> prefix and run the control, the execution will stop at that line and
give you a <code>pry</code> shell. Use that to troubleshoot, print variables, see
methods available, etc. For the above example:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">pry</span><span class="o">&gt;</span> <span class="n">perl_out</span><span class="p">.</span><span class="nf">exit_status</span>
<span class="o">=&gt;</span> <span class="mi">0</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">pry</span><span class="o">&gt;</span> <span class="n">perl_out</span><span class="p">.</span><span class="nf">stderr</span>
<span class="o">=&gt;</span> <span class="s2">""</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">pry</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="n">perl_out</span>
<span class="no">Inspec</span><span class="o">::</span><span class="no">Plugins</span><span class="o">::</span><span class="no">Resource</span><span class="c1">#methods: inspect</span>
<span class="no">Inspec</span><span class="o">::</span><span class="no">Resources</span><span class="o">::</span><span class="no">Cmd</span><span class="c1">#methods: command  exist?  exit_status  result  stderr  stdout  to_s</span>
<span class="no">Inspec</span><span class="o">::</span><span class="no">Resource</span><span class="o">::</span><span class="no">Registry</span><span class="o">::</span><span class="no">Command</span><span class="c1">#methods: inspec</span>
<span class="n">instance</span> <span class="ss">variables: </span><span class="vi">@__backend_runner__</span>  <span class="vi">@__resource_name__</span>  <span class="vi">@command</span>  <span class="vi">@result</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">pry</span><span class="o">&gt;</span> <span class="n">perl_out</span><span class="p">.</span><span class="nf">stdout</span><span class="p">.</span><span class="nf">partition</span><span class="p">(</span><span class="s1">'@INC:'</span><span class="p">).</span><span class="nf">last</span><span class="p">.</span><span class="nf">strip</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"/Library/Perl/5.18/darwin-thread-multi-2level"</span><span class="p">,</span>
 <span class="s2">"    /Library/Perl/5.18"</span><span class="p">,</span>
<span class="o">...</span><span class="no">REDACTED</span><span class="o">...</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">pry</span><span class="o">&gt;</span> <span class="nb">exit</span>    <span class="c1"># or abort</span>
</code></pre></div>
<p>You can use <code>pry</code> inside both the controls DSL and resources. Similarly,
for dev and test, you can use <code>inspec shell</code> which is based on <code>pry</code>,
for example:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="err">$</span> <span class="n">inspec</span> <span class="n">shell</span>
<span class="no">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">interactive</span> <span class="no">InSpec</span> <span class="no">Shell</span>
<span class="no">To</span> <span class="n">find</span> <span class="n">out</span> <span class="n">how</span> <span class="n">to</span> <span class="n">use</span> <span class="n">it</span><span class="p">,</span> <span class="ss">type: </span><span class="n">help</span>

<span class="n">inspec</span><span class="o">&gt;</span> <span class="n">command</span><span class="p">(</span><span class="s1">'ls ~/projects/github/inspec/docs'</span><span class="p">).</span><span class="nf">stdout</span>
<span class="o">=&gt;</span> <span class="s2">"README.md</span><span class="se">\n</span><span class="s2">config.md</span><span class="se">\n</span><span class="s2">dev</span><span class="se">\n</span><span class="s2">dsl_inspec.md</span><span class="se">\n</span><span class="s2">dsl_resource.md</span><span class="se">\n</span><span class="s2">glossary.md</span><span class="se">\n</span><span class="s2">habitat.md</span><span class="se">\n</span><span class="s2">inputs.md</span><span class="se">\n</span><span class="s2">inspec_and_friends.md</span><span class="se">\n</span><span class="s2">matchers.md</span><span class="se">\n</span><span class="s2">migration.md</span><span class="se">\n</span><span class="s2">platforms.md</span><span class="se">\n</span><span class="s2">plugin_kitchen_inspec.md</span><span class="se">\n</span><span class="s2">plugins.md</span><span class="se">\n</span><span class="s2">profiles.md</span><span class="se">\n</span><span class="s2">reporters.md</span><span class="se">\n</span><span class="s2">resources</span><span class="se">\n</span><span class="s2">shared</span><span class="se">\n</span><span class="s2">shell.md</span><span class="se">\n</span><span class="s2">style.md</span><span class="se">\n</span><span class="s2">waivers.md</span><span class="se">\n</span><span class="s2">"</span>
<span class="n">inspec</span><span class="o">&gt;</span> <span class="n">command</span><span class="p">(</span><span class="s1">'ls ~/projects/github/inspec/docs'</span><span class="p">).</span><span class="nf">stdout</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">).</span><span class="nf">first</span>
<span class="o">=&gt;</span> <span class="s2">"README.md"</span>

<span class="n">inspec</span><span class="o">&gt;</span> <span class="n">help</span> <span class="n">command</span>
<span class="no">Name</span><span class="p">:</span> <span class="n">command</span>

<span class="no">Description</span><span class="p">:</span>
<span class="no">Use</span> <span class="n">the</span> <span class="n">command</span> <span class="no">InSpec</span> <span class="n">audit</span> <span class="n">resource</span> <span class="n">to</span> <span class="nb">test</span> <span class="n">an</span> <span class="n">arbitrary</span> <span class="n">command</span> <span class="n">that</span> <span class="n">is</span> <span class="n">run</span> <span class="n">on</span> <span class="n">the</span> <span class="nb">system</span><span class="o">.</span>

<span class="no">Example</span><span class="p">:</span>
<span class="n">describe</span> <span class="n">command</span><span class="p">(</span><span class="s1">'ls -al /'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">exist</span> <span class="p">}</span>
  <span class="n">its</span><span class="p">(</span><span class="s1">'stdout'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">match</span> <span class="sr">/bin/</span> <span class="p">}</span>
  <span class="n">its</span><span class="p">(</span><span class="s1">'stderr'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="s1">''</span> <span class="p">}</span>
  <span class="n">its</span><span class="p">(</span><span class="s1">'exit_status'</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="mi">0</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></column><div class="scrollToTop shadow-dark"><img id="scrollup" onerror="this.src='/images/home/arrow.png'" src="/images/home/arrow.svg" /></div></div><script>// Swiftype JS code snippet
(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','xzyJV6P7pgscygGyyTm8','2.0.0');
// end Swiftype code snippet

document.getElementsByClassName("st-default-search-input")[0].focus();</script></main></div><footer class="dark-bg" id="main-footer"><div class="strict-center" id="dlmsg"><div class="pad-under-xs"><img alt="image of octagon spinning" id="hex" onerror="this.src='/images/octagon.png'" src="/images/octagon.svg" /></div><h3 class="t-white pad-under-xs">Get started with Chef InSpec and rock on.</h3><div class="row align columns"><div class="strict-center"><a class="button btn-lg btn-purple shadow-dark margin-right-xs mobile-row-btn" href="/downloads"><i class="fa fa-cloud-download"></i><span>download InSpec 4</span></a><a class="button btn-lg btn-white-o shadow-dark mobile-row-btn" href="/tutorials">browse tutorials</a></div></div></div><div class="flex align"><div class="columns large-4 medium-4 mobile-hide"><ul class="footer--logos"><li><a class="footer--logo inspec" href="/"><img alt="logo for Chef InSpec" src="/images/chef-inspec.png" /></a></li><li><a class="footer--logo chef" href="https://www.chef.io"><img alt="logo for Chef Software" src="/images/chef-logo.png" /></a></li></ul></div><div class="columns large-8 medium-8"><ul class="footer--links strict-right"><li><a class="link footer--link" href="https://docs.chef.io/chef_license.html">Licensing</a></li><li><a class="link footer--link" href="https://www.chef.io/terms-of-service/">Terms &amp; Conditions</a></li><li><a class="link footer--link" href="https://www.chef.io/trademark-policy/">Trademark Policy</a></li><li><a class="link footer--link" href="https://www.chef.io/privacy-policy/">Privacy Policy</a></li><li><a class="link footer--link" href="https://www.chef.io/cookie-policy/">Cookie Policy</a></li></ul><div class="columns margin-both-xs mobile-show"><ul class="footer--logos"><li><a class="footer--logo inspec" href="/"><img alt="logo for Chef InSpec" src="/images/chef-inspec.png" /></a></li><li><a class="footer--logo chef" href="http://www.chef.io"><img alt="logo for Chef Software" src="/images/chef-logo.png" /></a></li></ul></div></div></div><p class="strict-center pad-under-xs"><small class="t-gray">&copy; Chef Software 2015-2019</small></p></footer><script src="https://buttons.github.io/buttons.js"></script><script src="/scripts/inspec_tutorial.js"></script><script src="/dist/inspec_tutorial.js"></script><script src="/javascripts/vendor/jquery.min.js"></script><script src="https://s3.amazonaws.com/menumaker/menumaker.min.js"></script><div class="inspec-tutorial" hidden="true" inspec-tutorial="true">Loading</div><script src="/javascripts/all.js"></script><script>function initSlideGroup(group) {
  var prev = -1;
  var links = $(group).find('a')

  links.click(function(e) {
    e.stopPropagation()

    links.removeClass('selected')
    $(this).addClass('selected')

    var idx = $(this).index();
    if(prev == idx) return;
    prev = idx;

    $('.slider .view.slide-in').removeClass('slide-in').addClass('slide-out')
    var el = $('.slider .view')[idx]
    if(el == null) {
      console.log("No element for slider index "+idx)
      return
    }

    $(el).removeClass('slide-out').removeClass('hidden').addClass('slide-in')
  })

  if(links[0] != null) links[0].click();
}

function initSliders() {
  $('.slider .view').addClass('hidden')
  var groups = $('.slider .selectors')
  groups.each(function(idx){
    initSlideGroup(this)
  })
}

//run code colors

$(document).ready(function() {
  initSliders()
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});

//copy to clipboard

function copyToClipboard(element) {
  var $temp = $("<input>");
  $("body").append($temp);
  $temp.val($(element).text()).select();
  document.execCommand("copy");
  $temp.remove();
}

$('#copy').hover(function() {
   $('#install').toggleClass("text-focus");
});

$('#copy').click(function() {
   $(this).removeClass("fa-copy");
   $(this).addClass("fa-check");

 setTimeout(() => {
   $(this).removeClass('fa-check').addClass('fa-copy');
  }, 1500);
});

// homepage content slider

// tutorial content slider

$(function() {
  $(".collapseContent").hide();
  $(".collapsebtn").addClass("fa-plus-square");

   $('.collapseToggle').click(function() {
      var el = $(this).parent().find('.collapseContent')
      el.slideToggle("fast")
      // $('.collapseContent').slideToggle("fast");
      var btn = $(this).find('.collapsebtn')
      if(btn.hasClass('fa-minus-square')) {
        btn.addClass('fa-plus-square')
        btn.removeClass('fa-minus-square')
      } else {
        btn.addClass('fa-minus-square')
        btn.removeClass('fa-plus-square')
      }
   });
});



// scroll spy animations

var $slide_left = $('.slide-left');
var $slide_right = $('.slide-right');
var $slide_up = $('.slide-up');
var $slide_up_slow = $('.slide-up-slow');
var $window = $(window);

function check_if_in_view() {
  var window_height = $window.height();
  var window_top_position = $window.scrollTop();
  var window_bottom_position = (window_top_position + window_height);

  $.each($slide_left, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });

  $.each($slide_right, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });

  $.each($slide_up, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });

  $.each($slide_up_slow, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
        (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });
}

$window.on('scroll resize', check_if_in_view);
$window.trigger('scroll');

//scroll to top
$(document).ready(function(){

  $(window).scroll(function(){
    if ($(this).scrollTop() > 100) {
      $('.scrollToTop').fadeIn();
    } else {
      $('.scrollToTop').fadeOut();
    }
  });

  $('.scrollToTop').click(function(){
    $('html, body').animate({scrollTop : 0},800);
    return false;
  });

  // scrolling to resource sections
  $(".resources-button").click(function() {
    var dst = $(this).attr("href")
    $(".resources-button").removeClass("btn-purple").addClass("btn-purple-o")
    $(this).addClass("btn-purple").removeClass("btn-purple-o")
    $("html, body").animate({
        scrollTop: $(dst).offset().top - 105
    }, 1000);
  });

});

//scrolling code box

var div = $('#scrolled');
   setInterval(function(){
    var pos = div.scrollTop();
    div.scrollTop(pos + 2);
}, 200);

//Animating progress bar for header

$(document).ready(function(){

var getMax = function(){
    return $(document).height() - $(window).height();
}

var getValue = function(){
    return $(window).scrollTop();
}

if('max' in document.createElement('progress')){
    // Browser supports progress element
    var progressBar = $('progress');

    // Set the Max attr for the first time
    progressBar.attr({ max: getMax() });

    $(document).on('scroll', function(){
        // On scroll only Value attr needs to be calculated
        progressBar.attr({ value: getValue() });
    });

    $(window).resize(function(){
        // On resize, both Max/Value attr needs to be calculated
        progressBar.attr({ max: getMax(), value: getValue() });
    });
}
else {
    var progressBar = $('.progress-bar'),
        max = getMax(),
        value, width;

    var getWidth = function(){
        // Calculate width in percentage
        value = getValue();
        width = (value/max) * 100;
        width = width + '%';
        return width;
    }

    var setWidth = function(){
        progressBar.css({ width: getWidth() });
    }

    $(document).on('scroll', setWidth);
    $(window).on('resize', function(){
        // Need to reset the Max attr
        max = getMax();
        setWidth();
    });
    }
  });</script><script>$(document).foundation();
$('.try-demo').click(function(event){
  event.stopPropagation();
  $('.inspec-tutorial').show()
  window.dispatchEvent(new Event('resizeTerminal'));
  $('.quit-inspec-tutorial').click(function(event){
    event.stopPropagation();
    $('.inspec-tutorial').hide()
  })
});</script><script src="/javascripts/segment.js"></script></body></html>